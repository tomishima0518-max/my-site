<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ryuten Portal</title>

<style>
body{
    font-family:sans-serif;
    background:#f9f9f9;
    padding:20px;
}

h1{
    text-align:center;
}

ul{
    list-style:none;
    padding:0;
    display:flex;
    gap:10px;
    cursor:pointer;
}

ul li{
    padding:8px 14px;
    background:#eee;
    border-radius:6px;
    user-select:none;
}

ul li.active{
    background:red;
    color:#fff;
}

.video-box{
    border:3px solid red;
    padding:20px;
    border-radius:15px;
    background:#fff;
    margin:20px auto;
    max-width:600px;
}

.thumbnail{
    height:220px;
    margin-top:15px;
    border-radius:10px;
    background-size:cover;
    background-position:center;
}

.button{
    display:inline-block;
    margin-top:10px;
    padding:8px 14px;
    background:red;
    color:#fff;
    border-radius:6px;
    text-decoration:none;
}

.channel-btn{
    background:green;
    margin-left:10px;
}

.card{
    border:1px solid #ccc;
    border-radius:10px;
    padding:10px;
    margin:15px 0;
    background:#fff;
}

.card img{
    width:100%;
    border-radius:10px;
}
</style>
</head>

<body>

<h1>ğŸ”¥ Ryuten Portal</h1>

<!-- ãƒšãƒ¼ã‚¸ä¸Šéƒ¨ã‚¿ãƒ– -->
<ul id="mainTabs">
    <li class="active" data-tab="info">æƒ…å ±</li>
    <li data-tab="videos">å‹•ç”»ï¼†ã‚·ãƒ§ãƒ¼ãƒˆ</li>
    <li data-tab="other">ä»–</li>
</ul>

<div id="infoTab">
    <p>ã“ã®ã‚µã‚¤ãƒˆã¯ãƒªãƒ¥ã‚¦ãƒ†ãƒ³ã®æœ€æ–°å‹•ç”»ã‚„ã‚·ãƒ§ãƒ¼ãƒˆã‚’ãƒã‚§ãƒƒã‚¯ã§ãã‚‹ãƒãƒ¼ã‚¿ãƒ«ã§ã™ã€‚</p>
</div>

<div id="videosTab" style="display:none;">
    <!-- å†…éƒ¨ã‚¿ãƒ– -->
    <ul id="videoInnerTabs" style="margin-top:15px;">
        <li class="active" data-sort="latest">æœ€æ–°</li>
        <li data-sort="popular">äººæ°—é †</li>
        <li data-sort="old">å¤ã„</li>
    </ul>

    <!-- ãƒ¡ã‚¤ãƒ³å‹•ç”» -->
    <div class="video-box">
        <h2>æœ€æ–°å‹•ç”»</h2>
        <div id="mainThumbnail" class="thumbnail"></div>
        <h3 id="mainTitle">èª­ã¿è¾¼ã¿ä¸­...</h3>
        <p id="mainViews">å†ç”Ÿå›æ•°: ---</p>
        <a id="mainWatch" class="button" target="_blank">â–¶ è¦‹ã‚‹</a>
        <a href="https://www.youtube.com/@%E3%83%AA%E3%83%A5%E3%82%A6%E3%83%86%E3%83%B3%E3%81%AEGame%E5%AE%9F%E6%B3%81" 
           target="_blank" class="button channel-btn">ğŸ  ãƒãƒ£ãƒ³ãƒãƒ«ã¸</a>
    </div>

    <!-- å‹•ç”»ä¸€è¦§ -->
    <div id="videoGrid"></div>
</div>

<div id="otherTab" style="display:none;">
    <p>ãã®ä»–ãƒªãƒ³ã‚¯ã‚„æƒ…å ±ã‚’ã“ã“ã«è¡¨ç¤ºã§ãã¾ã™ã€‚</p>
</div>

<script>
const API_KEY = "AIzaSyCrywE11RwAJm5_MsUAkcZ_WQECJehcLRY";
const CHANNEL_ID = "UCmZY34Ev1I5FIcDC5tdXeDg";
let videosData = []; // å–å¾—å‹•ç”»ãƒ‡ãƒ¼ã‚¿ä¿æŒ

// ----------------- ä¸Šéƒ¨ã‚¿ãƒ–åˆ‡æ›¿ -----------------
document.querySelectorAll("#mainTabs li").forEach(tab=>{
    tab.addEventListener("click", ()=>{
        document.querySelectorAll("#mainTabs li").forEach(t=>t.classList.remove("active"));
        tab.classList.add("active");
        const showId = tab.dataset.tab + "Tab";
        document.querySelectorAll("#infoTab, #videosTab, #otherTab").forEach(d=>d.style.display="none");
        document.getElementById(showId).style.display="block";
    });
});

// ----------------- å†…éƒ¨å‹•ç”»ã‚¿ãƒ–åˆ‡æ›¿ -----------------
document.querySelectorAll("#videoInnerTabs li").forEach(tab=>{
    tab.addEventListener("click", ()=>{
        document.querySelectorAll("#videoInnerTabs li").forEach(t=>t.classList.remove("active"));
        tab.classList.add("active");
        sortAndDisplayVideos(tab.dataset.sort);
    });
});

// ----------------- YouTube APIå–å¾— -----------------
async function loadYouTube(){
    const searchUrl = `https://www.googleapis.com/youtube/v3/search?key=${API_KEY}&channelId=${CHANNEL_ID}&part=snippet&order=date&maxResults=20&type=video`;
    const searchRes = await fetch(searchUrl);
    const searchData = await searchRes.json();
    if(!searchData.items) return;

    const videoIds = searchData.items.map(v=>v.id.videoId).join(",");
    const statsUrl = `https://www.googleapis.com/youtube/v3/videos?key=${API_KEY}&id=${videoIds}&part=statistics,snippet`;
    const statsRes = await fetch(statsUrl);
    const statsData = await statsRes.json();

    videosData = statsData.items.map(item=>({
        id: item.id,
        title: item.snippet.title,
        thumbnail: item.snippet.thumbnails.high.url,
        views: Number(item.statistics.viewCount),
        publishedAt: new Date(item.snippet.publishedAt)
    }));

    // ğŸ”¥ ãƒ¡ã‚¤ãƒ³å‹•ç”»è¡¨ç¤º
    const first = videosData[0];
    document.getElementById("mainThumbnail").style.backgroundImage = `url('${first.thumbnail}')`;
    document.getElementById("mainTitle").textContent = first.title;
    document.getElementById("mainViews").textContent = `å†ç”Ÿå›æ•°: ${first.views.toLocaleString()} å›`;
    document.getElementById("mainWatch").href = `https://www.youtube.com/watch?v=${first.id}`;

    // åˆæœŸè¡¨ç¤ºã¯æœ€æ–°é †
    sortAndDisplayVideos("latest");
}

// ----------------- ä¸¦ã³æ›¿ãˆï¼†è¡¨ç¤º -----------------
function sortAndDisplayVideos(type){
    if(videosData.length===0) return;
    let sorted = [...videosData];

    if(type==="popular") sorted.sort((a,b)=>b.views-a.views);
    else if(type==="latest") sorted.sort((a,b)=>b.publishedAt-b.publishedAt);
    else if(type==="old") sorted.sort((a,b)=>a.publishedAt-b.publishedAt);

    const grid = document.getElementById("videoGrid");
    grid.innerHTML = "";

    sorted.forEach(item=>{
        grid.innerHTML += `
        <div class="card">
            <img src="${item.thumbnail}">
            <h3>${item.title}</h3>
            <p>å†ç”Ÿå›æ•°: ${item.views.toLocaleString()} å›</p>
            <a class="button" href="https://www.youtube.com/watch?v=${item.id}" target="_blank">â–¶ è¦‹ã‚‹</a>
        </div>
        `;
    });
}

loadYouTube();
</script>

</body>
</html>
