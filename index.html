<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>3DDOORSå®Œå…¨ç‰ˆ</title>
<style>
  body { margin:0; overflow:hidden; font-family:sans-serif; background:#000; color:#fff; }
  #ui { position:absolute; top:10px; left:10px; z-index:10; }
  #hpBar { width:300px; height:20px; background:#555; }
  #hpFill { width:100%; height:100%; background:#0f0; }
  #timerBar { width:300px; height:20px; background:#555; margin-top:5px; }
  #timerFill { width:100%; height:100%; background:#0f0; }
  #message { margin-top:10px; white-space:pre-line; }
  #difficultyButtons button { margin-right:5px; padding:5px 10px; }
</style>
</head>
<body>
<div id="ui">
  <div id="difficultyButtons">
    <button onclick="startGame('easy')">ç°¡å˜</button>
    <button onclick="startGame('normal')">æ™®é€š</button>
    <button onclick="startGame('hard')">ãƒãƒ¼ãƒ‰</button>
  </div>
  <div id="hpBar"><div id="hpFill"></div></div>
  <div id="timerBar"><div id="timerFill"></div></div>
  <div id="message"></div>
</div>

<script src="https://cdn.jsdelivr.net/npm/three@0.155.0/build/three.min.js"></script>
<script>
let scene, camera, renderer;
let playerHP = 300;
let currentDoor = 1;
let difficulty;
let timer = 0;
let timerMax = 0;
let timerInterval;
let timerActive = false;

// ã‚²ãƒ¼ãƒ é–‹å§‹
function startGame(mode){
  difficulty = mode;
  document.getElementById('difficultyButtons').style.display='none';
  initScene();
  elevatorDrop();
}

// Three.jsåˆæœŸåŒ–
function initScene(){
  scene = new THREE.Scene();
  camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
  camera.position.set(0,1.6,5);

  renderer = new THREE.WebGLRenderer({antialias:true});
  renderer.setSize(window.innerWidth, window.innerHeight);
  document.body.appendChild(renderer.domElement);

  // åºŠ
  let floor = new THREE.Mesh(
    new THREE.BoxGeometry(10,0.1,10),
    new THREE.MeshBasicMaterial({color:0x333})
  );
  scene.add(floor);

  // ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ãƒ‰ã‚¢1ã€œ3
  for(let i=0;i<3;i++){
    let door = new THREE.Mesh(
      new THREE.BoxGeometry(1,2,0.1),
      new THREE.MeshBasicMaterial({color:0x888})
    );
    door.position.set(i*3-3,1,0);
    door.name = 'door'+(i+1);
    scene.add(door);
  }

  animate();
}

// ã‚¨ãƒ¬ãƒ™ãƒ¼ã‚¿ãƒ¼è½ä¸‹æ¼”å‡º
function elevatorDrop(){
  let dropTime = 0;
  let dropInterval = setInterval(()=>{
    camera.position.y -= 0.02;
    dropTime += 0.02;
    if(dropTime>=5){
      clearInterval(dropInterval);
      postElevatorEffect();
    }
  },10);
}

// è½ä¸‹å¾Œã®æ–‡å­—è¡¨ç¤ºãƒšãƒŠãƒ«ãƒ†ã‚£
function postElevatorEffect(){
  let message = document.getElementById('message');
  if(difficulty=='easy') message.innerText='ç°¡å˜ãƒ¢ãƒ¼ãƒ‰: ãƒšãƒŠãƒ«ãƒ†ã‚£ãªã—';
  else if(difficulty=='normal') message.innerText='æ™®é€šãƒ¢ãƒ¼ãƒ‰: ãƒ€ãƒ¡ãƒ¼ã‚¸35 & ãƒ‰ã‚¢12ã¾ã§ã‚¹ãƒ”ãƒ¼ãƒ‰5%ä½ä¸‹';
  else message.innerText='ãƒãƒ¼ãƒ‰ãƒ¢ãƒ¼ãƒ‰: ãƒ€ãƒ¡ãƒ¼ã‚¸80 & ãƒ‰ã‚¢15ã¾ã§ã‚¹ãƒ”ãƒ¼ãƒ‰10%ä½ä¸‹';

  message.innerText += '\nãƒ‰ã‚¢1ã‹ã‚‰ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«é–‹å§‹';
}

// ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ãƒ«ãƒ¼ãƒ—
function animate(){
  requestAnimationFrame(animate);
  renderer.render(scene, camera);
}

// HPæ›´æ–°
function updateHP(amount){
  playerHP = Math.max(0, playerHP+amount);
  let fill = document.getElementById('hpFill');
  fill.style.width = (playerHP/300*100)+'%';
  if(playerHP<=0){
    document.getElementById('message').innerText='ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼ğŸ’€';
    clearInterval(timerInterval);
  }
}

// ã‚¿ã‚¤ãƒãƒ¼ã‚¢ã‚¿ãƒƒã‚¯é–‹å§‹
function startTimerAttack(){
  timerActive = true;
  timerMax = (difficulty=='easy')?35:(difficulty=='normal')?25:20;
  timer = timerMax;
  let fill = document.getElementById('timerFill');
  timerInterval = setInterval(()=>{
    timer -= 0.1;
    let pct = timer/timerMax*100;
    if(pct>60) fill.style.background='green';
    else if(pct>30) fill.style.background='yellow';
    else if(pct>10) fill.style.background='orange';
    else if(pct>0) fill.style.background='red';
    else {
      fill.style.background='gray';
      document.getElementById('message').innerText='â˜ ï¸ã‚¿ã‚¤ãƒãƒ¼ã‚¢ã‚¿ãƒƒã‚¯ãƒ€ãƒ¡ãƒ¼ã‚¸ç™ºç”Ÿ!';
      updateHP(-75);
      timer = timerMax;
    }
    fill.style.width = (Math.max(0,pct))+'%';
  },100);
}
</script>
</body>
</html>
