<!doctype html>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>ふぁんしーあいらんど｜ホラートロッコ</title>

<style>
html,body{margin:0;background:#000;overflow:hidden}
#g{position:fixed;inset:0;background:#050505}
.e{position:absolute;width:48px;height:68px;background:#400}
.s{background:#024}
.h{position:absolute;top:-5px;left:0;height:4px;background:red}
#c{position:fixed;width:22px;height:22px;border:2px solid #f33;border-radius:50%;pointer-events:none}
#u{position:fixed;left:6px;bottom:6px;color:#fff;font-size:12px}
</style>

<div id="g"></div>
<div id="c"></div>
<div id="u">
<span id="a"></span>/<span id="r"></span> ❤️<span id="l"></span>
</div>

<script>
let g=document.getElementById("g"),
c=document.getElementById("c"),
aE=a,rE=r,lE=l,
a=15,r=100,l=3,ch=0;

function u(){aE.textContent=a;rE.textContent=r;lE.textContent=l}
u();

onmousemove=e=>{
 c.style.left=e.clientX-11+"px";
 c.style.top=e.clientY-11+"px";
};

onmousedown=_=>ch=Date.now();
onmouseup=_=>ch=0;

onkeydown=e=>{
 if(e.key=="r"&&r){
  let n=Math.min(15-a,r);
  a+=n;r-=n;u();
 }
};

function sp(){
 if(l<=0)return;
 let e=document.createElement("div"),
 safe=Math.random()<0.2;
 e.className="e"+(safe?" s":"");
 let mh=2+Math.random()*5|0;
 e.h=mh;

 let h=document.createElement("div");
 h.className="h";
 h.style.width="100%";
 e.appendChild(h);

 e.style.left=Math.random()*(innerWidth-48)+"px";
 e.style.top=Math.random()*(innerHeight*0.5)+"px";

 e.onclick=v=>{
  v.stopPropagation();
  if(!a||l<=0)return;

  let d=1;
  if(ch&&Date.now()-ch>=650)d=3;   // チャージ弾
  if(v.offsetY<18)d*=2;           // ヘッドショット

  a--;
  if(!safe){
   e.h-=d;
   h.style.width=e.h/mh*100+"%";
   if(e.h<=0)e.remove();
  }else{
   l--; // ⑥の敵：撃つとダメージ
  }
  u();
 };

 if(!safe){
  setTimeout(()=>{
   if(e.isConnected){
    l--;u();e.remove();
   }
  },2200);
 }

 g.appendChild(e);
}

setInterval(sp,1700);
</script>
