<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>3DDOORS æœ€çµ‚MAXğŸ”¥</title>
<style>
body{margin:0;font-family:sans-serif;background:#111;color:#fff;display:flex;flex-direction:column;align-items:center;}
#game{width:100%;max-width:600px;height:450px;border:2px solid #fff;position:relative;background:#222;margin-top:10px;overflow:hidden;}
#ui{position:absolute;top:10px;left:10px;z-index:10;width:95%;}
#hpBar,#timerBar{width:100%;height:20px;background:#555;margin-bottom:5px;border-radius:5px;overflow:hidden;}
#hpFill,#timerFill{width:100%;height:100%;transition:width 0.2s,background 0.2s;}
#message{margin-top:5px;white-space:pre-line;font-size:14px;min-height:50px;}
.door,.item,.stairs,.enemy,.boss{width:80px;height:120px;background:#888;position:absolute;bottom:20px;cursor:pointer;text-align:center;line-height:120px;font-weight:bold;border-radius:5px;transition:all 0.5s;}
.enemy{background:#b00;color:#fff;}
.boss{background:#800080;color:#fff;width:120px;height:150px;line-height:150px;left:50%;transform:translateX(-50%);}
#openDoorBtn,#pickupBtn,#climbBtn{position:absolute;bottom:180px;left:50%;transform:translateX(-50%);padding:10px 20px;font-size:16px;display:none;background:#444;border:1px solid #fff;border-radius:5px;}
#inventory{position:absolute;bottom:0;width:100%;display:flex;justify-content:flex-start;overflow-x:auto;background:#222;border-top:2px solid #fff;padding:5px 0;}
.invItem{min-width:50px;height:50px;margin-left:5px;background:#555;display:flex;align-items:center;justify-content:center;border-radius:5px;font-size:12px;cursor:pointer;}
button{font-size:16px;margin:3px;}
#difficultyButtons{margin-top:10px;}
</style>
</head>
<body>

<div id="game">
  <div id="ui">
    <div id="hpBar"><div id="hpFill"></div></div>
    <div id="timerBar"><div id="timerFill"></div></div>
    <div id="message">é›£æ˜“åº¦ã‚’é¸æŠã—ã¦ãã ã•ã„</div>
  </div>
  <button id="openDoorBtn">é–‹ã</button>
  <button id="pickupBtn">æ‹¾ã†</button>
  <button id="climbBtn">ä¸Šã‚‹</button>
</div>

<div id="inventory"></div>

<div id="difficultyButtons">
  <button onclick="startGame('easy')">ç°¡å˜</button>
  <button onclick="startGame('normal')">æ™®é€š</button>
  <button onclick="startGame('hard')">ãƒãƒ¼ãƒ‰</button>
</div>

<script>
let playerHP=300,difficulty,currentDoor=1,timer,timerMax;
let inventory=[],doors=[],items=[],stairs=[],enemies=[];
let selectedDoor=null,selectedItem=null,selectedStair=null;
let timerInterval;
let boss=null;

// HPæ›´æ–°
function updateHP(amount){
  playerHP=Math.max(0,playerHP+amount);
  document.getElementById('hpFill').style.width=(playerHP/300*100)+'%';
  if(playerHP<=0) showMessage('ğŸ’€ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼');
}

// ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
function showMessage(msg){document.getElementById('message').innerText=msg;}

// ã‚¯ãƒªã‚¢è¦ç´ 
function clearElements(arr){arr.forEach(e=>e.remove());arr.length=0;}

// ãƒ‰ã‚¢ç”Ÿæˆ
function createDoors(indices){
  clearElements(doors);
  let game=document.getElementById('game');
  indices.forEach((i,idx)=>{
    let d=document.createElement('div');
    d.className='door';
    d.id='door'+i;
    d.innerText='ãƒ‰ã‚¢'+i;
    d.style.left=(50+idx*150)+'px';
    game.appendChild(d);
    doors.push(d);
    d.onclick=()=>{selectedDoor=d;document.getElementById('openDoorBtn').style.display='block';};
  });
}

// ã‚¢ã‚¤ãƒ†ãƒ ç”Ÿæˆ
function spawnItem(name){
  let game=document.getElementById('game');
  let item=document.createElement('div');
  item.className='item';
  item.innerText=name;
  item.style.left=Math.random()*400+'px';
  game.appendChild(item);
  items.push(item);
  item.onclick=()=>{selectedItem=item;document.getElementById('pickupBtn').style.display='block';document.getElementById('pickupBtn').innerText='æ‹¾ã†: '+name;};
}

// éšæ®µç”Ÿæˆ
function spawnStair(){
  let game=document.getElementById('game');
  let stair=document.createElement('div');
  stair.className='stairs';
  stair.innerText='éšæ®µ';
  stair.style.left=Math.random()*400+'px';
  game.appendChild(stair);
  stairs.push(stair);
  stair.onclick=()=>{selectedStair=stair;document.getElementById('climbBtn').style.display='block';};
}

// æ•µç”Ÿæˆ
function spawnEnemy(name='ã‚¿ã‚¤ãƒãƒ¼ã‚¢ã‚¿ãƒƒã‚¯æ•µ'){
  let game=document.getElementById('game');
  let enemy=document.createElement('div');
  enemy.className='enemy';
  enemy.innerText=name;
  enemy.style.left=Math.random()*400+'px';
  game.appendChild(enemy);
  enemies.push(enemy);
  enemy.onclick=()=>{
    let dmg=(name.includes('ã‚¢ãƒ³ãƒ–ãƒƒã‚·ãƒ¥')||name.includes('ãƒ©ãƒƒã‚·ãƒ¥'))?100:
            name.includes('ã‚·ãƒ¼ã‚¯')?playerHP:
            name.includes('ãƒˆãƒ©ãƒƒãƒ—')?45:5;
    showMessage(name+'ã«è§¦ã‚ŒãŸ! '+dmg+'ãƒ€ãƒ¡ãƒ¼ã‚¸');
    updateHP(-dmg);
    enemy.remove();
  };
}

// ãƒœã‚¹ç”Ÿæˆ
function spawnBoss(){
  if(boss) boss.remove();
  let game=document.getElementById('game');
  boss=document.createElement('div');
  boss.className='boss';
  boss.innerText='ãƒœã‚¹';
  boss.style.top='50px';
  game.appendChild(boss);
  moveBoss();
}

// ãƒœã‚¹ã‚¢ãƒ‹ãƒ¡
function moveBoss(){
  if(!boss) return;
  let left=parseInt(boss.style.left||300);
  let direction=Math.random()<0.5?1:-1;
  boss.style.left=(left+direction*20)+'px';
  setTimeout(moveBoss,500);
}

// ãƒ‰ã‚¢ãƒœã‚¿ãƒ³
document.getElementById('openDoorBtn').onclick=()=>{
  if(selectedDoor){selectedDoor.remove();selectedDoor=null;document.getElementById('openDoorBtn').style.display='none';nextDoor();}
}

// ã‚¢ã‚¤ãƒ†ãƒ ãƒœã‚¿ãƒ³
document.getElementById('pickupBtn').onclick=()=>{
  if(selectedItem){
    let name=selectedItem.innerText;inventory.push(name);updateInventory();selectedItem.remove();selectedItem=null;document.getElementById('pickupBtn').style.display='none';showMessage(name+'ã‚’æ‹¾ã£ãŸ!');}
}

// éšæ®µãƒœã‚¿ãƒ³
document.getElementById('climbBtn').onclick=()=>{
  if(selectedStair){selectedStair.remove();selectedStair=null;document.getElementById('climbBtn').style.display='none';showMessage('éšæ®µã‚’ä¸Šã£ãŸ!');spawnRoom();}
}

// ã‚¤ãƒ³ãƒ™ãƒ³ãƒˆãƒªæ›´æ–°
function updateInventory(){
  let inv=document.getElementById('inventory');inv.innerHTML='';
  inventory.forEach((item,i)=>{
    let div=document.createElement('div');
    div.className='invItem';
    div.innerText=item;
    div.onclick=()=>{
      showMessage(item+'ã‚’ä½¿ç”¨!');
      if(item=='å›å¾©è–¬') updateHP(50);
      inventory.splice(i,1);updateInventory();
    };
    inv.appendChild(div);
  });
}

// ã‚²ãƒ¼ãƒ é–‹å§‹
function startGame(mode){
  difficulty=mode;
  document.getElementById('difficultyButtons').style.display='none';
  showMessage('ã‚¨ãƒ¬ãƒ™ãƒ¼ã‚¿ãƒ¼è½ä¸‹ä¸­...');
  setTimeout(()=>startTutorial(),2000);
}

// ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«
function startTutorial(){
  showMessage('ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«é–‹å§‹\nãƒ‰ã‚¢1: éµã‚’å–ã‚‹');
  createDoors([1,2,3]);
}

// ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«é€²è¡Œ
function nextDoor(){
  currentDoor++;
  if(currentDoor==2) showMessage('ãƒ‰ã‚¢2: ã—ã‚ƒãŒã‚€ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«');
  else if(currentDoor==3) showMessage('ãƒ‰ã‚¢3: éš ã‚Œã‚‹ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«');
  else if(currentDoor>=4) startMainGame();
}

// æœ¬ç•ªã‚²ãƒ¼ãƒ 
function startMainGame(){
  showMessage('æœ¬ç•ªé–‹å§‹! ãƒ‰ã‚¢5ä»¥é™ã‚¿ã‚¤ãƒãƒ¼ã‚¢ã‚¿ãƒƒã‚¯ç™»å ´');
  spawnRoom();
  startTimerAttack();
  setTimeout(spawnBoss,5000);
}

// éƒ¨å±‹ç”Ÿæˆ
function spawnRoom(){
  createDoors([1]);
  spawnItem('å›å¾©è–¬');
  spawnItem('ã‚¹ãƒ”ãƒ¼ãƒ‰ã‚¢ãƒƒãƒ—');
  spawnItem('ã‚·ãƒ¼ãƒ«ãƒ‰');
  spawnItem('éµ');
  spawnStair();
  spawnEnemy('ã‚¢ãƒ³ãƒ–ãƒƒã‚·ãƒ¥');
  spawnEnemy('ãƒ©ãƒƒã‚·ãƒ¥');
  if(Math.random()<0.3) spawnEnemy('ã‚·ãƒ¼ã‚¯');
  if(Math.random()<0.5) spawnEnemy('ãƒˆãƒ©ãƒƒãƒ—');
  if(Math.random()<0.7) spawnEnemy('ã‚¯ãƒ¢');
}

// ã‚¿ã‚¤ãƒãƒ¼ã‚¢ã‚¿ãƒƒã‚¯
function startTimerAttack(){
  timerMax=(difficulty=='easy')?35:(difficulty=='normal')?25:20;
  timer=timerMax;
  let fill=document.getElementById('timerFill');
  timerInterval=setInterval(()=>{
    timer-=0.1;
    let pct=timer/timerMax*100;
    if(pct>60) fill.style.background='green';
    else if(pct>30) fill.style.background='yellow';
    else if(pct>10) fill.style.background='orange';
    else if(pct>0) fill.style.background='red';
    else{
      fill.style.background='gray';
      showMessage('â˜ ï¸ã‚¿ã‚¤ãƒãƒ¼ã‚¢ã‚¿ãƒƒã‚¯! 75ãƒ€ãƒ¡ãƒ¼ã‚¸');
      updateHP(-75);
      timer=timerMax;
    }
    fill.style.width=Math.max(0,pct)+'%';
  },100);
}
</script>
</body>
</html>
